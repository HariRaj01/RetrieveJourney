
<!DOCTYPE html>
<html>
<head>
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.0/axios.min.js"
      integrity="sha512-DZqqY3PiOvTP9HkjIWgjO6ouCbq+dxqWoJZ/Q+zPYNHmlnI2dQnbJ5bxAHpAMw+LXRm4D72EIRXzvcHQtE8/VQ=="
      crossorigin="anonymous"
    ></script>
    <title>OutPut Page </title>
    <style>header {
      background-color: rgb(45, 27, 201);
      padding: 30px;
      text-align: center;
      font-size: 35px;
      color:goldenrod;
    }
  </style>
  <header>
    <h2>RETRIEVE JSON DATA</h2>
  </header> <br><br> 

      <button type="button" style="background-color:rgb(45, 27, 201);margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%;color:goldenrod" onclick="getJourneyById()">
        GET JOURNEY JSON
     </button> <br><br>
     <select id="sel" style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%" >
      <option style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%"  value="" onchange="showJson(this)" >-- Select --</option>
    </select>
    <br/>
    <button onClick="GetSelectedItem('sel');">Get Selected Item</button>

      <!-- <textarea id="demo" style="margin-left:auto;margin-right:auto;display:block;margin-top:0%;margin-bottom:0%" size="10000"name="json data"></textarea> -->
  <div>
    <p style="background-color:rgb(47, 201, 27)" id="demo"></p>
  </div>
    <br><br>
    
</head>

<body>
  <input type="hidden" id="rt" />
  <input type="hidden" id="mid" />
  <input type="hidden" id="oat" />
  <input type="hidden" id="siu" />
  <script>
    let apptoken="";
   const queryString = window.location.search;
    const urlParams = new URLSearchParams(queryString);
    const authorization_code = urlParams.get('code');
    console.log("authorization_code",authorization_code);
    // const tssd = urlParams.get('tssd');
    const tssd ="mcj6cy1x9m-t5h5tz0bfsyqj38ky";
    if(authorization_code!= null)
    {
      getOAuthAccessToken()
    }
      function getOAuthAccessToken(req,res) {
        
        axios({
          method: "POST",
          url: "/appdemoauthtoken",
          data: {
            authorization_code:authorization_code,
            tssd: tssd
          },
        })
          .then(function (response) {
            console.log(
              "accesstokengeneration:" +
                JSON.stringify(response.data))
                AppUserInfo(    
           apptoken={
               refreshToken : response.data.refreshToken,
               oauthToken : response.data.oauthToken

             })
                      
          })
          .catch(function (error) {
            console.log(error);
          });
      }

      function AppUserInfo( apptoken ) {
       console.log("Response from accessToken", apptoken.oauthToken);
        axios({
          method: "POST",
          url: "/appuserinfo",
          data: 
          { 
             refreshToken: apptoken.refreshToken,
             oauthToken : apptoken.oauthToken,
             tssd:tssd },

        })
          .then(function (response) {
            console.log("response>>>>",response);
            if(response.data){
            $('#rt').val(response.data.refreshToken);
            $('#mid').val(response.data.member_id);
            $('#oat').val(response.data.oauthToken);
            $('#siu').val(response.data.soap_instance_url); 
            }           
              /*getJourneyById(
                  param=
                  {
                    memberid : response.data.member_id,
                    refreshToken:response.data.refreshToken,
                    oauthToken : response.data.oauthToken,
                    soap_instance_url : response.data.soap_instance_url
                  }
                  )*/
                 
          })
        }

      function getJourneyById()
      {
        let refreshToken =  $('#rt').val();
        let oauthToken =  $('#oat').val();
        let memberid =  $('#mid').val();
        let soap_instance_url =  $('#siu').val();
        console.log("RefreshToken",refreshToken);
        
        var inputName= document.getElementById("input_value").value
        console.log("Given Name:",inputName);
        
        //let JourneyId = 'b8d3952d-6586-4a96-8ae5-01a5c218e090';
        axios(
          {
            method:"POST",
            url: "/getJourneysById",
            data: {
              refreshToken:refreshToken,
              oauthToken:oauthToken,
              memberid:memberid,
              soap_instance_url:soap_instance_url,
              // journeyId:JourneyId
            }
          })

        .then(function(response)
        {
          let journeyName= new Array();
          console.log("Journey Response:",JSON.stringify(response));
         console.log("JSON Data-Activity:",response.data.activity)
      
         var ele = document.getElementById('sel');
         for (var i = 0; i < response.data.activity.items.length; i++) {  
              // POPULATE SELECT ELEMENT WITH JSON.
           
            ele.innerHTML = ele.innerHTML +'<option value="' + response.data.activity.items[i]['name'] + '">' + response.data.activity.items[i]['name'] + '</option>';
          

        //   if(inputName==response.data.activity.items[i].name){
          
         // break;   
        //}
      }

        
       // else 
        //document.getElementById("demo").innerText="Invalid Journey Name or Error in getting JSON Data"

      //}
        })
        
        .catch(function(error)
        {
          document.getElementById("demo").innerText = "Invalid Journey Name or Error in getting JSON Data"
          console.log(error);
        })
      }
    
      function GetSelectedItem(el)
      {
          var e = document.getElementById(el);
          var strSel = "The Value is: " + e.options[e.selectedIndex].value + " and text is: " + e.options[e.selectedIndex].text;
          document.getElementById("demo").innerText=e.selectedIndex;

      }
  </script>
</body>
</html>
   
